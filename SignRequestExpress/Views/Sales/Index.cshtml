@addTagHelper "*, Microsoft.AspNetCore.Mvc.TagHelpers"

@{
    ViewData["Title"] = "Sales Home";
    Layout = "_Layout";
}

@section Links{
    <link rel="stylesheet" href="~/css/image-picker.css" />
}

<br />

<h2>Sales Dashboard <small>Control your Sign Requests</small></h2>

<h1>@ViewData["Message"]</h1>

<br />

<div class="card">
    <div class="card-header">
        <ul class="nav nav-tabs card-header-tabs nav-fill flex-column flex-md-row" id="salesTab" role="tablist">

            <li class="nav-item">
                <a class="nav-link active tab-link" id="create-tab" data-toggle="tab" role="tab" href="#createTab" aria-controls="createTab" aria-selected="true"><b>Create Request</b></a>
            </li>

            <li class="nav-item">
                <a class="nav-link tab-link" id="check-tab" data-toggle="tab" role="tab" href="#checkTab" aria-controls="checkTab" aria-selected="false"><b>Check Status</b></a>
            </li>

            <li class="nav-item">
                <a class="nav-link tab-link" id="prev-tab" data-toggle="tab" role="tab" href="#prevTab" aria-controls="prevTab" aria-selected="false"><b>Previous Requests</b></a>
            </li>

            <li class="nav-item">
                <a class="nav-link tab-link" id="account-tab" data-toggle="tab" role="tab" href="#accountTab" aria-controls="accountTab" aria-selected="false"><b>Account Management</b></a>
            </li>
        </ul>
    </div>

    <div class="card-body local-card-body">
        <div class="tab-content" id="salesTabContent">
            <div class="tab-pane fade show active" id="createTab" role="tabpanel" aria-labelledby="create-tab">
                <partial name="_CreateRequestPartial" />
            </div>

            <div class="tab-pane fade" id="checkTab" role="tabpanel" aria-labelledby="check-tab">
                <partial name="_CheckStatusPartial" />
            </div>

            <div class="tab-pane fade" id="prevTab" role="tabpanel" aria-labelledby="prev-tab">
                <partial name="_PreviousRequestPartial" />
            </div>

            <div class="tab-pane fade" id="accountTab" role="tabpanel" aria-labelledby="account-tab">
                <partial name="_AccountRequestPartial" />
            </div>
        </div>
    </div>
</div>


@section Scripts{
    <!--<script type="text/javascript" src="~/js/sales.js"></script>-->

    <script type="text/javascript" src="~/js/image-picker.js"></script>
    <script type="text/javascript" src="~/js/masonry.pkgd.js"></script>

    <script>
        $('select[name="brandSelect"]').change(function () {
            if ($(this).val() != "Select Brand") {
                $("#templateBtn").prop('disabled', false);
            }
            else {
                $("#templateBtn").prop('disabled', true);
            }

            // Changing the templates in the modal
            let brand = {
                "BrandName": $('#templateBrand option:selected').val().trim()
            };

            $.ajax({
                type: "POST",
                url: "/Sales/GetTemplates",
                contentType: "application/json; charset=utf-8",
                dataType: "html",
                data: JSON.stringify(brand),
                success: function (result, status, xhr) {

                    result = result.replace('[', '');
                    result = result.replace(']', '');
                    result = result.replace(/\"/g, '');

                    var array = result.split(',');
                    $('#templateSelect').empty();
                    // TODO: use 2D array to hold data to post - GUID?
                    for (var i = 0; i < array.length; i++) {
                        var option = "<option data-img-src=" + array[i] + " value=\"" + array[i] + "\" data-img-class=\"template-picker\"></option>";
                        $('#templateSelect').append(option);
                    }
                    $(".image-picker").imagepicker({
                        hide_select: true,
                        show_label: false,
                        auto_update: true,

                        // callback functions???

                        //limit: 1
                        
                    });
                    // will need to iterate over and determine class to apply for vertical or horizontal images
                },
                error: function (xhr, status, error) {
                    $("#dataDiv").html(error);
                }
            });
        });

        //This doesn't work yet
        $("#heightInput").change(function () {
            if ($(this).val() > $("#widthInput").val()) {
                var $orientationRad = $('input:radio[name=signOrientation]');
                $orientationRad.filter('[value=vertical]').prop('checked', true);
                $orientationRad.filter('[value=horizontal]').prop('checked', false);

            }
        });


    </script>

}


